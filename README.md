# 五度圏Webアプリ

**作成日**: 2025年11月13日
**作成者**: 蔵人
**目的**: HPSメンバーの学習支援、音楽理論の視覚化

---

## 公開URL

**本番**: https://murinaikurashi.com/apps/circle-of-fifths/

---

## 使い方

### ローカルで開く
1. Finderで以下のファイルをダブルクリック:
   `/Users/nozakidaikai/Obsidian/デジタル百姓総本部/プロジェクト/五度圏アプリ/index.html`
2. ブラウザで開きます

### 操作方法
- **外側の円**: 長調（C, G, D, A, E, B, G♭, D♭, A♭, E♭, B♭, F）
- **内側の円**: 短調（Am, Em, Bm, F#m, C#m, G#m, E♭m, B♭m, Fm, Cm, Gm, Dm）
- **キー選択**: キーを選択すると、調号、平行調、ダイアトニックコードのディグリーが表示されます
  - 長調選択時：メジャーダイアトニック（I, ii, iii, IV, V, vi, vii）
  - 短調選択時：ナチュラル/ハーモニック/メロディックマイナーを切り替え可能
  - メジャーコードは外側、マイナーコード/ディミニッシュは内側に表示
  - **裏コード（♭II7）も表示**
- **スケールモード切り替え**（マイナーキー選択時）:
  - 中央の「Melodic」「Harmonic」ボタンで切り替え
  - ナチュラルマイナー（デフォルト）、ハーモニックマイナー、メロディックマイナー
- **コード進行**: 右側のドロップダウンから1625, 4536などのよくあるコード進行を選択できます
  - 選択したキーに合わせて、ディグリー、機能（トニック/サブドミナント/ドミナント）、コード名、ルート音が表示されます
  - ♯系キーでは♯表記、♭系キーでは♭表記で統一されます

---

## 現在の機能

- ✅ **モバイル対応**（スワイプナビゲーション、ドットインジケーター）
- ✅ 五度圏の円形表示（外側：長調、内側：短調）
- ✅ キーをクリックして選択
- ✅ 調号の情報表示（♯の数、♭の数）
- ✅ 平行調の表示
- ✅ ダイアトニックコード表示（ディグリー）
  - 長調：I, ii, iii, IV, V, vi, vii + ノンダイアトニック（I7, IV7, IVm7, viidim7, ♭II7）
  - 短調：スケールモードで切り替え（Natural / Harmonic / Melodic）
  - メジャーコードは外側（大）、マイナーコードは内側（小）に表示
- ✅ **裏コード（♭II7）表示** - ドミナントの代理として五度圏上に表示
- ✅ **スケールモード切り替え** - マイナーキーでNatural/Harmonic/Melodicを切り替え
- ✅ コード進行表示機能
  - メジャー系：251, 1625, 王道進行, 12小節ブルース, 8小節ブルース など
  - マイナー系：マイナー251, Thrill is Gone進行, マイナーブルース など
  - 機能別色分け（トニック：オレンジ、サブドミナント：青、ドミナント：赤）
  - 選択キーに合わせて異名同音を自動調整（♯系/♭系）

---

## 今後の追加予定

- [ ] 64パッドとの対応表示
- [ ] 音声再生機能

---

## 技術仕様

- **言語**: HTML, CSS, JavaScript
- **グラフィック**: SVG
- **外部ライブラリ**: なし（Pure JavaScript）
- **ホスティング**: Xserver（murinaikurashi.com）
- **デプロイ**: Github Actions（自動）

---

## 開発フロー（Github Actions自動デプロイ）

### 基本ルール
**動作確認してからpush → 自動で公開される！**

### 手順

1. **機能を追加・修正する**
   - `index.html` を編集

2. **ローカルで動作確認**
   - Finderで `index.html` をダブルクリック
   - ブラウザで動作を確認
   - **問題があれば修正**

3. **gitにコミット＆push（自動デプロイ）**
   ```bash
   cd "/Users/nozakidaikai/Obsidian/デジタル百姓総本部/プロジェクト/五度圏アプリ"
   git add .
   git commit -m "v0.x: 機能追加の説明"
   git push
   ```
   → **Github Actionsが自動でXserverにデプロイ**

4. **公開URLで確認**
   - https://murinaikurashi.com/apps/circle-of-fifths/
   - 問題なければ完了！

### デプロイ状況の確認

```bash
# Github Actionsの実行状況を確認
gh run list

# 特定の実行の詳細を確認
gh run view <run-id>
```

### 手動デプロイ（緊急時）

自動デプロイがうまくいかない場合：
```bash
./deploy.sh
```

### 巻き戻し方法

もし問題があったら、gitで前のバージョンに戻してpush：

```bash
# コミット履歴を確認
git log --oneline

# 特定のバージョンに戻す
git revert <コミットID>
# または
git reset --hard <コミットID>

# 再度push（自動デプロイされる）
git push
```

---

## Github設定情報

- **リポジトリ**: https://github.com/daikainozaki-cyber/circle-of-fifths
- **Secrets**: `XSERVER_SSH_KEY`（SSH秘密鍵）
- **ワークフロー**: `.github/workflows/deploy.yml`
- **トリガー**: mainブランチへのpush

### Xserver接続情報
- ホスト: `xs071284.xsrv.jp`
- ポート: `10022`
- ユーザー: `xs071284`
- 国外IPアクセス制限: OFF（Github Actionsのため）

---

## 更新履歴

### v1.1.0 (2025-11-28)
- **モバイル対応を追加**
  - スマートフォンでの閲覧に最適化
  - 横スワイプで3画面切り替え（五度圏 / コード / 進行）
  - ドットインジケーターでナビゲーション表示
  - タップでパネル間を直接移動可能
- **モバイル用レイアウト最適化**
  - 五度圏を画面幅いっぱい（100vw）に表示
  - ディグリー表示を大きく（老眼対応）
  - マイナーコードのディグリーを白い中心円の外接位置に配置
  - info-panelをコンパクト化

### v1.0 (2025-11-28)
- **ホスティング移行: Netlify → Xserver**
  - 公開URL: https://murinaikurashi.com/apps/circle-of-fifths/
  - Github Actions による自動デプロイを導入
  - mainブランチへのpushで自動的にXserverに反映
- **スケールモード切り替え機能を追加**（マイナーキー）
  - ナチュラルマイナー（デフォルト）
  - ハーモニックマイナー（V7がダイアトニック、im(Maj7)など）
  - メロディックマイナー（IV7、vim7(♭5)、viim7(♭5)など）
  - 中央の「Melodic」「Harmonic」ボタンで切り替え
- **裏コード（♭II7）を五度圏上に表示**
  - メジャー・マイナー両方で表示
  - ドミナント系（赤色）で表示
- **ダイアトニックコード表の拡充**
  - ノンダイアトニックだが実用的なコードを「※」マーク付きで表示
  - ブルース系（I7, IV7）、サブドミナントマイナー（IVm7）など

### v0.9 (2025-11-28)
- **3ペインレイアウトに変更**
  - 左：五度圏
  - 中央：ダイアトニックコード表
  - 右：コード進行セレクター + 表示 + 解説
- **コード進行に解説を追加**
  - 各進行に音楽理論的な説明を追加
  - 解説パネル（オレンジ枠）で表示
- **ブルース進行のグリッド表示**
  - 12小節ブルース、8小節ブルースを4×3または4×2のグリッドで視覚化
  - 機能別に色分け（トニック：オレンジ、サブドミナント：青、ドミナント：赤）
- **8小節ブルースを追加**
  - 「Key to the Highway」などで有名な形式
  - ゴスペルでも多用される進行
- **2拍ずつ分割表示に対応**
  - 「I7/IV7」のような1小節に2コードの表記をサポート
  - 8小節ブルースの7-8小節目で使用（ターンアラウンド）
- **解説の追加・修正**
  - 251進行：裏コード（♭II7）への交換可能を追記
  - サブドミナントマイナー進行：ゴスペル/ソウルでの使用法、#IVdim7バリエーションを追記
  - 12小節ブルース：ターンアラウンドの説明を追記
  - クイック・チェンジ・ブルース：4度音とターンアラウンドバリエーションを追記
  - スリーコード：トライアドで演奏されることも多いと追記
  - 1345進行：解説を削除（独自解説ではないため）

### v0.8.1 (2025-11-22)
- **バグ修正 - vii°m7(♭5) → viim7(b5) に修正（3箇所）**
  - メジャーキーのダイアトニックコード定義（366行目）
  - 五度圏上表示用リスト（576行目）
  - ダイアトニック一覧表用リスト（680行目）
  - ディミニッシュ記号（°）とフラット記号（♭）を削除し、統一的な表記に修正

### v0.8 (2025-11-14)
- **UX改善 - 同じタイプ内でのキー変更時、進行選択を維持**
  - メジャー→メジャー、マイナー→マイナーのキー変更時、選択していたコード進行を維持
  - 例：CメジャーでII-V-I選択 → Gメジャーに変更 → II-V-IがGのキーで自動的に表示
  - メジャー→マイナー、マイナー→メジャーのタイプ変更時は進行選択をクリア
  - 実装：`selectKey()`で前回タイプを保存、`updateProgressionSelect(shouldClear)`で選択維持/クリアを判定

### v0.7.2 (2025-11-14)
- **バグ修正 - bⅦ7の重複表示を削除**
  - マイナーキーのダイアトニックコード定義で重複していたbⅦ7を1つ削除

### v0.7.1 (2025-11-14)
- **バグ修正 - bⅦmaj7 → bⅦ7 に修正（4箇所）**
  - メジャーキーのダイアトニックコード定義（367行目）
  - マイナーキーのダイアトニックコード定義（381行目）
  - メジャーキーのコード進行プリセット I-bVII-IV-I（397行目）
  - 五度圏上表示用とダイアトニック一覧表用のリスト（575, 677行目）
  - bⅦはドミナント7th（bⅦ7）が正しい表記

### v0.7 (2025-11-14)
- **UI改善 - フォント最適化とレイアウト調整**
  - ページタイトルを削除し、五度圏の中央に「五度圏 / Circle of Fifths」を表示
  - スクロールなしで完全に表示可能に
  - フォントを美しく最適化
    - システムフォントスタック追加（-apple-system, Roboto, Helvetica Neue等）
    - アンチエイリアシング有効化
    - `text-rendering: optimizeLegibility` で最適化
    - `dominant-baseline: middle` で垂直中央揃え
  - マイナーキーのテキスト位置を外側に調整（重なりを解消）
  - ディグリー表示の円の位置・サイズを最適化
    - マイナーコードのディグリー：内側に配置、適切なサイズ調整
    - マイナーキーのテキストとの重なりを解消
    - 区切り線とのまたがりを解消

### v0.6.1 (2025-11-14)
- **UI改善 - スクロールなしで全表示可能に**
  - ダイアトニックコード一覧表を右パネルに移動
  - 情報パネルから「ダイアトニックコード: 五度圏上に表示されています」メッセージを削除
  - 全体のレイアウトをコンパクト化
    - フォントサイズを調整（0.9em）
    - パディング・マージンを削減
    - テーブルの行高を圧縮
  - キー選択 + コード進行表示でもスクロール不要

### v0.6 (2025-11-14)
- **ダイアトニックコード一覧表を追加**
  - 五度圏の下にダイアトニックコード一覧表を表示
  - ディグリー、コード名、機能が表形式で確認可能
  - 機能別の色分け表示（トニック/サブドミナント/ドミナント）
  - マイナーキー選択時はナチュラルマイナー（vm7）とハーモニックマイナー（V7）の両方を併記
  - メジャーキー：7つのダイアトニックコード表示
  - マイナーキー：8つのダイアトニックコード表示（vm7とV7含む）

### v0.5 (2025-11-14)
- **マイナー系コード進行10選を追加**（ジャズ/ブルース向け）
  - マイナー・ツーファイブワン (IIm7♭5-V7-Im)
  - マイナー・ブルース (Im-IVm-V7-Im)
  - マイナー・ライン・クリシェ (Im-Im(Maj7)-Im7-Im6)
  - セカンダリー・ドミナント (Im-I7-IVm-V7)
  - ハーモニック・マイナー進行 (Im-bVI-V7-Im)
  - リラティブ・メジャーへ (IIm7♭5-V7-Im-bIII)
  - ディミニッシュ・アプローチ (Im-VIIdim-V7-Im)
  - ナチュラルマイナー系 (Im-IVm-bVII-bIII)
  - ツーファイブへの準備 (Im-bVI-IIm7♭5-V7)
  - 王道進行マイナー版 (bVI-bVII-Im-V7)
- **機能別色分け実装**
  - トニック系：オレンジ (#ff9800)
  - サブドミナント系：ブルー (#42a5f5)
  - ドミナント系：レッド (#ef5350)
  - 代理コードも同じ機能で同じ色表示（学習支援）
- **動的ドロップダウン実装**
  - メジャーキー選択時：メジャー系進行10選を表示
  - マイナーキー選択時：マイナー系進行10選を表示
  - キータイプ切り替え時に進行表示をリセット
- **マイナーキーのオフセット計算を修正**
  - デュアルオフセットシステム導入（`offset`と`circleOffset`）
  - `offset`: コード進行の実際の根音計算用（マイナートニック基準）
  - `circleOffset`: 五度圏上の表示位置用（平行長調基準）
  - bVI, VII, bVII, bIIIなどのオフセット値を正確に調整
- **UI改善**
  - 五度圏上はダイアトニックコードのみ表示（ノンダイアトニックを除外）
  - メジャーキー選択時にIVm7が表示されないように修正
  - ディグリー表記の重複を修正（roman + suffix構造の分離）
  - ii°の°記号を削除して統一（iim7(♭5)）

### v0.4 (2025-11-14)
- メジャー系コード進行10選に変更
  - ツーファイブワン (II-V-I)
  - 50s進行 (I-VI-IV-V)
  - 王道進行 (I-V-VI-IV)
  - 王道進行バリエ (IV-V-I-VI)
  - サブドミナント・マイナー進行 (IV-IVm-I-I7)
  - スリーコード (I-IV-V-I)
  - 1625進行 (I-VI-II-V)
  - IV-V-III-VI, I-III-IV-V, I-bVII-IV-I
- ノンダイアトニックコード対応（IVm7, I7, bVII）
- 五度圏上は基本ダイアトニックのみ表示、コード進行パネルではノンダイアトニックも使用可能

### v0.3 (2025-11-14)
- コード進行表示機能を追加（1625, 4536, 1456, 1564, 1645）
- 2カラムレイアウト実装（左：五度圏、右：コード進行パネル）
- ディグリー、機能（T/SD/D）、コード名、ルート音を表で表示
- 異名同音対応（♯系キーは♯表記、♭系キーは♭表記で統一）
- G♭表記に統一（F♯ではなくG♭を採用）

### v0.2 (2025-11-13)
- ダイアトニックコード表示機能を追加
- 長調：メジャーダイアトニック（I, ii, iii, IV, V, vi, vii°）
- 短調：ナチュラルマイナーダイアトニック（i, ii°, bIII, iv, v, bVI, bVII）
- メジャーコードは外側に大きく、マイナーコードは内側に小さく表示
- 短調キー名と重ならないように位置調整

### v0.1 (2025-11-13)
- 基本的な五度圏表示を実装
- キー選択機能
- 調号情報表示

---

## デザイン要望

![[5度圏.png]]
![[改善.png]]![[更に改善.png]]